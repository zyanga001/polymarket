<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyå¹³è¡¡èµ„é‡‘è®¡ç®—å™¨</title>
    <style>
        /* Base and Utility Styles */
        :root {
            /* ç°ä»£æ·±ç´«/è–„è·ç»¿é…è‰² */
            --color-primary: #7c3aed; /* Violet 600 */
            --color-secondary: #059669; /* Emerald 600 */
            --color-bg: #f9fafb; /* Lighter background for depth */
            --color-surface: #ffffff;
            --color-border: #e5e7eb;
            --color-text: #1f2937;
            --color-copy: #f59e0b; /* Amber for Copy button */
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px 20px 40px; 
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            
            /* **ä¿®æ”¹ç‚¹:** å®ç°å…¨å±å±…ä¸­ */
            display: flex;
            flex-direction: column; /* å‚ç›´å †å å†…å®¹å— */
            justify-content: center; /* å‚ç›´å±…ä¸­å†…å®¹å— */
            align-items: center; /* æ°´å¹³å±…ä¸­å†…å®¹å— (container) */
            min-height: 100vh; /* ç¡®ä¿ body è‡³å°‘å æ»¡æ•´ä¸ªè§†å£é«˜åº¦ */
            /* ç»“æŸä¿®æ”¹ç‚¹ */
        }

        .container {
            width: 100%;
            max-width: 550px; /* è¿›ä¸€æ­¥æ”¶çª„ï¼Œæ›´ç´§å‡‘ */
            margin: 0 auto; /* ç¡®ä¿åœ¨ flex å®¹å™¨å†…ä¹Ÿèƒ½ä¿æŒè‰¯å¥½é—´è· */
            background-color: var(--color-surface);
            padding: 25px; /* ç•¥å¾®å‡å°‘ padding */
            border-radius: 20px; /* å¢åŠ åœ†è§’ï¼Œæ›´åœ†æ¶¦ */
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1), 0 6px 10px -3px rgba(0, 0, 0, 0.05);
        }

        /* Header and Title */
        h1 {
            color: var(--color-primary);
            text-align: center;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px; /* å‡å°‘ margin */
            padding-bottom: 10px;
            border-bottom: 2px solid var(--color-border);
        }

        h2 {
            font-size: 1.3rem;
            color: var(--color-text);
            margin-top: 20px; /* å‡å°‘ margin */
            margin-bottom: 10px; /* å‡å°‘ margin */
            text-align: center; /* å±…ä¸­ */
        }

        /* --- Input Card Group --- */
        .input-group {
            display: grid;
            /* é»˜è®¤åœ¨çª„å±ä¸Šæ˜¯ä¸¤åˆ—è‡ªé€‚åº” */
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px; 
            padding: 15px; /* å‡å°‘ padding */
            border: 1px solid var(--color-border);
            border-radius: 15px; /* å¢åŠ åœ†è§’ */
            background-color: #f7f9fc; /* æµ…åº•è‰²åŒºåˆ† */
            margin-bottom: 15px; /* å‡å°‘ margin */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        /* å¼ºåˆ¶åœ¨å®½å±ä¸Šæ˜¾ç¤ºä¸ºå››åˆ—ï¼Œå®ç°å•è¡Œè¦æ±‚ */
        @media (min-width: 500px) {
            .input-group {
                grid-template-columns: 1fr 1fr 1fr 1fr;
                gap: 10px;
            }
        }
        
        /* é€šç”¨è¾“å…¥é¡¹å±…ä¸­ */
        .input-item {
            text-align: center; 
        }

        .input-item label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #4b5563;
            font-size: 0.85rem; /* å­—ä½“ç•¥å°ï¼Œé€‚åº”ç´§å‡‘å¸ƒå±€ */
        }

        input[type="number"] {
            width: 100%;
            max-width: 100px; /* é™åˆ¶è¾“å…¥æ¡†æœ€å¤§å®½åº¦ï¼Œçº¦ 6-8 ä½æ•°å­—é•¿åº¦ */
            padding: 10px 8px; 
            border: 1px solid var(--color-border);
            border-radius: 8px; /* å¢åŠ åœ†è§’ */
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
            text-align: center; /* è¾“å…¥æ•°å­—å±…ä¸­æ˜¾ç¤º */
            margin: 0 auto; 
            display: block; 
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        /* --- Range Control Group (ä¹Ÿåº”ç”¨æ›´å°çš„è¾“å…¥æ¡†) --- */
        .range-control-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px; 
            padding: 15px; 
            border: 1px solid var(--color-border);
            border-radius: 15px; 
            background-color: #f7f9fc; 
            /* ç§»é™¤åº•è¾¹è·ï¼Œç”±çˆ¶å®¹å™¨ .flex-control-row ç®¡ç† */
            margin-bottom: 0; 
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .range-control-group .input-item {
            text-align: center;
        }

        /* --- New Flex Row for Controls and Buttons --- */
        .flex-control-row {
            display: flex;
            flex-direction: column; /* é»˜è®¤åœ¨çª„å±ä¸Šå †å  */
            gap: 15px;
            margin-bottom: 20px; 
        }
        @media (min-width: 500px) {
            .flex-control-row {
                flex-direction: row; /* åœ¨æ¡Œé¢ç«¯å¹¶æ’ */
                justify-content: space-between; 
                align-items: center;
            }
            .flex-control-row .range-control-group {
                /* å…è®¸è¾“å…¥æ¡†å æ®æ›´å¤šç©ºé—´ */
                width: 55%; 
            }
        }


        /* Button Layout */
        .button-wrapper, .action-bar {
            display: flex;
            justify-content: center; /* æ ¸å¿ƒï¼šæŒ‰é’®ç»„å±…ä¸­ */
            gap: 15px;
            margin-bottom: 20px; /* å‡å°‘ margin */
        }
        
        /* é’ˆå¯¹ action-bar åœ¨æ–°çš„ flex å®¹å™¨ä¸­çš„è°ƒæ•´ */
        @media (min-width: 500px) {
            .action-bar {
                width: 40%; /* ç•™å‡ºåˆé€‚çš„ç©ºé—´ç»™æŒ‰é’® */
                /* æŒ‰é’®åå³å¯¹é½ */
                justify-content: flex-end; 
                margin-bottom: 0; 
            }
        }
        /* ç¡®ä¿ç§»åŠ¨ç«¯ action-bar åº•éƒ¨æ— é¢å¤–é—´è· */
        .action-bar {
            margin-bottom: 0;
        }


        .button-primary {
            width: 100%;
            max-width: 250px; 
            padding: 12px;
            background-color: var(--color-secondary);
            color: white;
            border: none;
            border-radius: 999px; /* **è¯ä¸¸å½¢çŠ¶åœ†è§’** */
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s, box-shadow 0.3s;
            box-shadow: 0 4px 10px rgba(5, 150, 105, 0.4);
        }
        
        .action-bar .button-primary {
            max-width: 180px; 
            padding: 10px; 
            font-size: 0.95rem;
            border-radius: 999px; /* **è¯ä¸¸å½¢çŠ¶åœ†è§’** */
            /* ç§»é™¤ max-width é™åˆ¶ï¼Œè®© flex å®¹å™¨æ§åˆ¶å®½åº¦ */
            max-width: none; 
        }

        .button-primary:hover {
            background-color: #047857;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(5, 150, 105, 0.5);
        }
        .button-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        /* Copy Button Specific Style */
        .copy-button {
            background-color: var(--color-copy); 
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.4);
        }
        .copy-button:hover {
            background-color: #d97706;
            box-shadow: 0 6px 12px rgba(245, 158, 11, 0.5);
        }

        /* Result Section */
        .result-section {
            margin-top: 15px; /* å‡å°‘ margin */
        }

        /* Summary Card */
        .summary {
            background-color: #f3e8ff; /* æµ…ç´«è‰²é…åˆæ–°ä¸»é¢˜è‰² */
            padding: 15px; /* å‡å°‘ padding */
            border-radius: 15px; /* å¢åŠ åœ†è§’ */
            margin-bottom: 15px; /* å‡å°‘ margin */
            border-left: 5px solid var(--color-primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .summary p {
            margin: 6px 0; /* å‡å°‘è¡Œé—´è· */
            font-size: 1rem;
            display: flex;
            justify-content: space-between;
        }
        .summary strong {
            color: var(--color-primary);
            font-weight: 700;
        }

        .summary hr {
            border: 0;
            border-top: 1px dashed #c4b5fd;
            margin: 10px 0; /* å‡å°‘ hr é—´è· */
        }

        /* Allocation Lists */
        .allocation-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px; /* å‡å°‘ gap */
        }
        @media (min-width: 500px) {
            .allocation-list {
                grid-template-columns: 1fr 1fr;
            }
        }

        .group {
            padding: 15px;
            border: 1px solid var(--color-border);
            border-radius: 15px; /* å¢åŠ åœ†è§’ */
            background-color: var(--color-surface);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }

        .group h3 {
            margin-top: 0;
            color: var(--color-secondary);
            font-size: 1.05rem;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 8px;
            margin-bottom: 10px;
            text-align: center; /* å±…ä¸­ */
        }

        .group ul {
            list-style: none;
            padding: 0;
            max-height: 200px; /* å‡å°‘æœ€å¤§é«˜åº¦ä»¥é¿å…æ»šåŠ¨ */
            overflow-y: auto;
        }

        .group ul li {
            /* **ä¿®æ”¹ç‚¹:** å¢åŠ äº†æ°´å¹³å†…è¾¹è· (10px)ï¼Œç¡®ä¿æ•°å­—ä¸æ»šåŠ¨æ¡æœ‰å……è¶³é—´éš” */
            padding: 8px 10px; 
            font-size: 0.9rem;
            border-bottom: 1px dashed #f3f4f6;
            display: flex;
            justify-content: space-between;
        }
        .group ul li:last-child {
            border-bottom: none;
        }
        
        .error-message {
            color: #dc2626;
            font-weight: 600;
            margin-top: 15px;
            padding: 12px;
            background-color: #fee2e2;
            border: 1px solid #fca5a5;
            border-radius: 8px;
            text-align: center;
        }

        .highlight-profit {
            color: var(--color-secondary);
            font-weight: 700;
        }
        .highlight-loss {
            color: #dc2626;
            font-weight: 700;
        }

        .copy-feedback {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--color-secondary);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
            transition: opacity 0.3s;
            opacity: 0;
        }
        
    </style>
</head>
<body>

<div class="container">
    <h1>Polyå¹³è¡¡èµ„é‡‘è®¡ç®—å™¨</h1>

    <!-- æ ¸å¿ƒå‚æ•°è¾“å…¥åŒº (å±…ä¸­å¡ç‰‡, å®½å±å››åˆ—) -->
    <div class="input-group">
        <div class="input-item">
            <label for="prob1">æ–¹å‘ä¸€æ¦‚ç‡ (%)</label>
            <!-- æ¦‚ç‡æ­¥è¿›å€¼æ”¹ä¸º 1 -->
            <input type="number" id="prob1" placeholder="ä¾‹å¦‚: 54" min="0" step="1">
        </div>
        <div class="input-item">
            <label for="prob2">æ–¹å‘äºŒæ¦‚ç‡ (%)</label>
            <!-- æ¦‚ç‡æ­¥è¿›å€¼æ”¹ä¸º 1 -->
            <input type="number" id="prob2" placeholder="ä¾‹å¦‚: 47" min="0" step="1">
        </div>
        <div class="input-item">
            <label for="accountCount">è´¦å·æ€»æ•°</label>
            <input type="number" id="accountCount" value="20" min="2" step="1">
        </div>
        <div class="input-item">
            <label for="averageAmount">æ¯æˆ·å¹³å‡æŠ•å…¥</label>
            <input type="number" id="averageAmount" value="2.5" min="0.01" step="0.01">
        </div>
    </div>
    
    <!-- åˆå§‹è®¡ç®—æŒ‰é’® (å±…ä¸­) -->
    <div class="button-wrapper">
        <button class="button-primary" onclick="calculateStrategy()">å¼€å§‹è®¡ç®—</button>
    </div>
    
    <div id="error-output" class="error-message" style="display: none;"></div>

    <div id="result-output" class="result-section" style="display: none;">
        
        <h2>ğŸ“Š èµ„é‡‘å¹³è¡¡æ‘˜è¦</h2>
        <div class="summary" id="summary-data"></div>

        <!-- éšæœºèŒƒå›´æ§ä»¶å’ŒæŒ‰é’®è¢«æ•´åˆåˆ° .flex-control-row ä¸­ -->
        <div class="flex-control-row">
            <!-- éšæœºèŒƒå›´æ§ä»¶ (è¾“å…¥æ¡†åå·¦) -->
            <div class="range-control-group">
                <div class="input-item">
                    <label for="minAmount">éšæœºæœ€å°å€¼</label>
                    <!-- éšæœºå€¼æ­¥è¿›å€¼æ”¹ä¸º 0.1 -->
                    <input type="number" id="minAmount" placeholder="é»˜è®¤: 1.5" min="0.01" step="0.1">
                </div>
                <div class="input-item">
                    <label for="maxAmount">éšæœºæœ€å¤§å€¼</label>
                    <!-- éšæœºå€¼æ­¥è¿›å€¼æ”¹ä¸º 0.1 -->
                    <input type="number" id="maxAmount" placeholder="é»˜è®¤: 4.0" min="0.01" step="0.1">
                </div>
            </div>

            <!-- é‡æ–°è®¡ç®—å’Œå¤åˆ¶æŒ‰é’® (æŒ‰é’®åå³) -->
            <div class="action-bar">
                 <button class="button-primary" onclick="calculateStrategy()">é‡æ–°è®¡ç®—</button>
                 <button class="button-primary copy-button" onclick="copyAllAllocations()">ä¸€é”®å¤åˆ¶</button>
            </div>
        </div>

        <h2>ğŸ’° éšæœºèµ„é‡‘åˆ†é…è¯¦æƒ…</h2>
        <div class="allocation-list">
            <div class="group">
                <h3 id="group1-title">æ–¹å‘ä¸€ (P1) åˆ†é…</h3>
                <ul id="allocation-list-1"></ul>
            </div>
            <div class="group">
                <h3 id="group2-title">æ–¹å‘äºŒ (P2) åˆ†é…</h3>
                <ul id="allocation-list-2"></ul>
            </div>
        </div>
    </div>
</div>

<div id="copy-feedback" class="copy-feedback">å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</div>

<script>
/**
 * æ˜¾ç¤ºå¤åˆ¶æˆåŠŸåé¦ˆ
 */
function showCopyFeedback() {
    const feedback = document.getElementById('copy-feedback');
    feedback.style.opacity = '1';
    setTimeout(() => {
        feedback.style.opacity = '0';
    }, 1500);
}

/**
 * å°†æ‰€æœ‰åˆ†é…é‡‘é¢ï¼ˆåˆ—è¡¨ä¸­çš„æ•°å­—ï¼‰æ•´ç†å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚
 */
function copyAllAllocations() {
    const list1 = document.getElementById('allocation-list-1');
    const list2 = document.getElementById('allocation-list-2');
    
    let allAllocations = [];

    // æå–æ–¹å‘ä¸€æ•°æ®
    if (list1.children.length > 0 && list1.children[0].textContent.includes('æŠ•å…¥:')) {
        Array.from(list1.children).forEach(li => {
            const amountText = li.querySelector('span').textContent;
            allAllocations.push(amountText.replace(/[^0-9.]/g, '')); // åªä¿ç•™æ•°å­—å’Œå°æ•°ç‚¹
        });
    }

    // æå–æ–¹å‘äºŒæ•°æ®
     if (list2.children.length > 0 && list2.children[0].textContent.includes('æŠ•å…¥:')) {
        Array.from(list2.children).forEach(li => {
            const amountText = li.querySelector('span').textContent;
            allAllocations.push(amountText.replace(/[^0-9.]/g, '')); // åªä¿ç•™æ•°å­—å’Œå°æ•°ç‚¹
        });
    }
    
    if (allAllocations.length === 0) {
        document.getElementById('error-output').textContent = 'æ²¡æœ‰ç”Ÿæˆçš„èµ„é‡‘åˆ†é…æ•°æ®å¯ä¾›å¤åˆ¶ã€‚è¯·å…ˆè¿è¡Œè®¡ç®—ã€‚';
        document.getElementById('error-output').style.display = 'block';
        return;
    }

    const dataToCopy = allAllocations.join('\n'); // æ¯è¡Œä¸€ä¸ªé‡‘é¢

    // ä½¿ç”¨ document.execCommand('copy') ä½œä¸ºå…¼å®¹æ€§æ›´å¥½çš„å¤åˆ¶æ–¹æ³•
    const tempInput = document.createElement('textarea');
    tempInput.value = dataToCopy;
    tempInput.setAttribute('readonly', '');
    tempInput.style.position = 'absolute';
    tempInput.style.left = '-9999px';
    document.body.appendChild(tempInput);
    tempInput.select();

    try {
        const successful = document.execCommand('copy');
        document.body.removeChild(tempInput);
        if (successful) {
            showCopyFeedback();
        } else {
            document.getElementById('error-output').textContent = 'å¤åˆ¶åˆ°å‰ªè´´æ¿å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚';
            document.getElementById('error-output').style.display = 'block';
        }
    } catch (err) {
        document.body.removeChild(tempInput);
        console.error('å¤åˆ¶å¤±è´¥:', err);
        document.getElementById('error-output').textContent = 'å¤åˆ¶åˆ°å‰ªè´´æ¿å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚';
        document.getElementById('error-output').style.display = 'block';
    }
}

/**
 * æ ¸å¿ƒéšæœºç²¾ç¡®åˆ†é…å‡½æ•°
 */
function randomizeAllocation(count, targetSum, minAmount, maxAmount, decimalPlaces = 2) {
    if (count <= 0 || targetSum <= 0) return [];
    
    const multiplier = Math.pow(10, decimalPlaces);
    
    // è½¬æ¢ä¸ºæ•´æ•°åˆ† (cents) è¿›è¡Œç²¾ç¡®è®¡ç®—
    const targetSumCents = Math.round(targetSum * multiplier);
    const minAmountCents = Math.round(minAmount * multiplier);
    const maxAmountCents = Math.round(maxAmount * multiplier);

    // 1. Feasibility Check (in cents) - æ£€æŸ¥æ€»æŠ•å…¥æ˜¯å¦åœ¨å¯è¡ŒèŒƒå›´å†…
    const minTotalCents = count * minAmountCents;
    const maxTotalCents = count * maxAmountCents;
    
    if (targetSumCents < minTotalCents) {
        throw new Error(`æ€»æŠ•å…¥ ${targetSum.toFixed(2)} å¤ªä½ã€‚${count} æˆ·çš„æœ€ä½æ€»æŠ•å…¥éœ€è¦ ${(minTotalCents/multiplier).toFixed(2)} (æ¯æˆ·æœ€å°å€¼ ${minAmount.toFixed(2)})ã€‚`);
    }
    if (targetSumCents > maxTotalCents) {
        throw new Error(`æ€»æŠ•å…¥ ${targetSum.toFixed(2)} å¤ªé«˜ã€‚${count} æˆ·çš„æœ€é«˜æ€»æŠ•å…¥åªèƒ½æ˜¯ ${(maxTotalCents/multiplier).toFixed(2)} (æ¯æˆ·æœ€å¤§å€¼ ${maxAmount.toFixed(2)})ã€‚`);
    }
    
    // 2. Initialize allocations with minimums and calculate remaining sum
    let currentAllocationsCents = Array(count).fill(minAmountCents);
    let remainingSumCents = targetSumCents - minTotalCents;
    
    // 3. Iteratively distribute the remaining sum to accounts, respecting the max limit
    let attempts = 0;
    
    // ä½¿ç”¨è¿­ä»£ç¡®ä¿åˆ†é…å‡åŒ€ä¸”ç²¾ç¡®
    while (remainingSumCents > 0 && attempts < count * 30) { 
        attempts++;
        const index = Math.floor(Math.random() * count);
        
        const canIncrementBy = maxAmountCents - currentAllocationsCents[index]; 
        
        if (canIncrementBy > 0) {
            // éšæœºå¢é‡: 0 åˆ° canIncrementBy ä¹‹é—´ï¼Œä½†ä¸èƒ½è¶…è¿‡ remainingSumCents
            let increment = Math.floor(Math.random() * (Math.min(canIncrementBy, remainingSumCents) + 1));
            
            // ç¡®ä¿è‡³å°‘å¢åŠ  1 åˆ†
            if (increment === 0 && remainingSumCents > 0 && canIncrementBy > 0) {
                 increment = Math.min(1, remainingSumCents, canIncrementBy);
            }

            if (increment > 0) {
                currentAllocationsCents[index] += increment;
                remainingSumCents -= increment;
            }
        }
    }
    
    // 4. Fallback for the final few cents (due to random distribution inefficiency)
    if (remainingSumCents > 0) {
        for (let i = 0; i < count && remainingSumCents > 0; i++) {
            const canIncrementBy = maxAmountCents - currentAllocationsCents[i];
            const increment = Math.min(remainingSumCents, canIncrementBy);
            if (increment > 0) {
                currentAllocationsCents[i] += increment;
                remainingSumCents -= increment;
            }
        }
    }

    // 5. Convert back to floating point amounts and shuffle
    const finalAllocations = currentAllocationsCents.map(cents => cents / multiplier);
    finalAllocations.sort(() => Math.random() - 0.5);

    return finalAllocations;
}

/**
 * ä¸»è®¡ç®—å‡½æ•°ï¼šæ‰§è¡Œåˆ†ç»„ã€èµ„é‡‘å¹³è¡¡è®¡ç®—å’Œéšæœºåˆ†é…
 */
function calculateStrategy() {
    const errorOutput = document.getElementById('error-output');
    const resultOutput = document.getElementById('result-output');
    errorOutput.style.display = 'none';
    
    // ç¡®ä¿ä¸»è®¡ç®—æŒ‰é’®ä¸å†å½±å“å¸ƒå±€
    const mainButtonWrapper = document.querySelector('.button-wrapper');
    if (mainButtonWrapper) {
        // æ¢å¤é»˜è®¤å±…ä¸­æ ·å¼ï¼Œå› ä¸ºç°åœ¨æ‰€æœ‰å…ƒç´ éƒ½åœ¨å±…ä¸­å®¹å™¨å†…
        mainButtonWrapper.style.maxWidth = ''; 
        mainButtonWrapper.style.margin = '';
    }


    try {
        // 1. è·å–è¾“å…¥å‚æ•°
        const P1_percent = parseFloat(document.getElementById('prob1').value);
        const P2_percent = parseFloat(document.getElementById('prob2').value);
        // è¯»å–å¸¦æœ‰é»˜è®¤å€¼çš„è¾“å…¥
        const N = parseInt(document.getElementById('accountCount').value || 20);
        const avgAmount = parseFloat(document.getElementById('averageAmount').value || 2.5);
        
        // è·å–éšæœºåˆ†é…èŒƒå›´
        let minAmount = parseFloat(document.getElementById('minAmount').value);
        let maxAmount = parseFloat(document.getElementById('maxAmount').value);

        minAmount = isNaN(minAmount) ? 1.5 : minAmount;
        maxAmount = isNaN(maxAmount) ? 4.0 : maxAmount;

        // åŸºç¡€æ ¡éªŒ
        if (isNaN(P1_percent) || isNaN(P2_percent) || P1_percent === "" || P2_percent === "") {
            throw new Error('è¯·å¡«å†™ä¸¤ä¸ªæ–¹å‘çš„æ¦‚ç‡ã€‚');
        }
        if (P1_percent <= 0 || P2_percent <= 0 || N <= 1 || avgAmount <= 0) {
            throw new Error('æ¦‚ç‡å¿…é¡»å¤§äº 0%ï¼Œè´¦å·æ€»æ•°éœ€å¤§äº 1ï¼Œå¹³å‡æŠ•å…¥éœ€å¤§äº 0ã€‚');
        }
        if (minAmount >= maxAmount || minAmount <= 0) {
            throw new Error('éšæœºæŠ•å…¥èŒƒå›´è®¾ç½®æ— æ•ˆ: æœ€å°å€¼å¿…é¡»å°äºæœ€å¤§å€¼ä¸”å¤§äº 0ã€‚');
        }

        const P1 = P1_percent / 100;
        const P2 = P2_percent / 100;
        const T = parseFloat((N * avgAmount).toFixed(2)); // æ€»æŠ•å…¥ï¼Œç²¾ç¡®åˆ°åˆ†

        // 2. è®¡ç®—è´¦å·æ•°é‡åˆ†é… (åŸºäºæ¦‚ç‡æ¯”ä¾‹)
        const totalP = P1 + P2;
        let N1 = Math.round(N * P1 / totalP);
        let N2 = N - N1;
        
        // ç¡®ä¿æ¯ä¸ªæ–¹å‘è‡³å°‘æœ‰ 1 ä¸ªè´¦å·å‚ä¸å¯¹å†²
        if (N1 < 1) { N1 = 1; N2 = N - 1; }
        if (N2 < 1) { N2 = 1; N1 = N - 1; }
        
        if (N1 === 0 || N2 === 0) {
            throw new Error('è´¦å·åˆ†é…é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ¦‚ç‡å€¼æ˜¯å¦è¿‡åˆ†åç¦»å¯¼è‡´æ— æ³•åˆ†é…åˆ°ä¸¤ä¸ªæ–¹å‘ã€‚');
        }

        // 3. è®¡ç®—éšå«èµ”ç‡ R (R = 1/P - 1)
        const R1 = 1 / P1 - 1;
        const R2 = 1 / P2 - 1;

        // 4. è®¡ç®—æœ€å°åŒ–æŸå¤±çš„èµ„é‡‘æ€»é¢åˆ†é… A1 å’Œ A2
        const totalFactor = R1 + R2 + 2;
        const A1_raw = (T * (R2 + 1)) / totalFactor;
        const A2_raw = (T * (R1 + 1)) / totalFactor;

        // è½¬æ¢ä¸ºç²¾ç¡®åˆ°åˆ†çš„é‡‘é¢ (toFixed(2))
        let A1 = parseFloat(A1_raw.toFixed(2));
        let A2 = parseFloat(A2_raw.toFixed(2));
        
        // ç¡®ä¿ A1 + A2 ä¸¥æ ¼ç­‰äº T (å¤„ç†æµ®ç‚¹æ•°è¯¯å·®)
        const A_sum_check = parseFloat((A1 + A2).toFixed(2));
        const totalDifference = parseFloat((T - A_sum_check).toFixed(2));
        if (totalDifference !== 0) {
            A1 = parseFloat((A1 + totalDifference).toFixed(2));
        }

        // 5. ç›ˆäºè®¡ç®— (éªŒè¯æœ€å°åŒ–æŸå¤±)
        const profit1 = A1 * R1;
        const loss2 = A2;
        const netG1 = parseFloat((profit1 - loss2).toFixed(2)); 

        const profit2 = A2 * R2;
        const loss1 = A1;
        const netG2 = parseFloat((profit2 - loss1).toFixed(2)); 
        
        // 6. æ ¸å¿ƒï¼šéšæœºç²¾ç¡®èµ„é‡‘åˆ†é… (ä¼ é€’æ–°çš„èŒƒå›´å‚æ•°)
        const allocations1 = N1 > 0 ? randomizeAllocation(N1, A1, minAmount, maxAmount) : [];
        const allocations2 = N2 > 0 ? randomizeAllocation(N2, A2, minAmount, maxAmount) : [];

        // 7. æ¸²æŸ“ç»“æœ
        
        // æ¸²æŸ“æ‘˜è¦ (ç®€æ´ç‰ˆæœ¬)
        const summaryData = document.getElementById('summary-data');
        
        // é€»è¾‘ä¿®æ­£ï¼šå‡€æ”¶ç›Š >= 0 ä¸ºç›ˆåˆ© (ç»¿è‰²/highlight-profit)ï¼Œ< 0 ä¸ºäºæŸ (çº¢è‰²/highlight-loss)
        const G1_class = netG1 >= 0 ? 'highlight-profit' : 'highlight-loss';
        const G2_class = netG2 >= 0 ? 'highlight-profit' : 'highlight-loss';

        summaryData.innerHTML = `
            <p><strong>æ€»æŠ•å…¥:</strong> <span>${T.toFixed(2)} (${N} æˆ·)</span></p>
            <hr>
            <p><strong>æ–¹å‘ä¸€ (${P1_percent}%):</strong> <span>${N1} æˆ·ï¼Œç›®æ ‡æŠ•å…¥ <strong style="color:var(--color-secondary);">${A1}</strong></span></p>
            <p><strong>æ–¹å‘äºŒ (${P2_percent}%):</strong> <span>${N2} æˆ·ï¼Œç›®æ ‡æŠ•å…¥ <strong style="color:var(--color-secondary);">${A2}</strong></span></p>
            <hr>
            <p><strong>è‹¥æ–¹å‘ä¸€èµ¢:</strong> <span class="${G1_class}">${netG1}</span></p>
            <p><strong>è‹¥æ–¹å‘äºŒèµ¢:</strong> <span class="${G2_class}">${netG2}</span></p>
        `;

        // æ¸²æŸ“åˆ—è¡¨
        const renderList = (ulId, allocations, P_percent, A_total) => {
            const ul = document.getElementById(ulId);
            ul.innerHTML = '';
            document.getElementById(ulId === 'allocation-list-1' ? 'group1-title' : 'group2-title').textContent = 
                `æ–¹å‘ (${P_percent}%) (æ€»å’Œ: ${A_total})`;

            if (allocations.length === 0) {
                 ul.innerHTML = '<li>è¯¥æ–¹å‘è´¦å·æ•°ä¸º 0ï¼Œæ²¡æœ‰èµ„é‡‘åˆ†é…ã€‚</li>';
                 return;
            }

            allocations.forEach((amount, index) => {
                ul.innerHTML += `<li>è´¦å· ${index + 1} æŠ•å…¥: <span>${amount.toFixed(2)}</span></li>`;
            });
        };

        renderList('allocation-list-1', allocations1, P1_percent, A1);
        renderList('allocation-list-2', allocations2, P2_percent, A2);

        resultOutput.style.display = 'block';

    } catch (e) {
        errorOutput.textContent = `è®¡ç®—é”™è¯¯ï¼š${e.message}`;
        errorOutput.style.display = 'block';
    }
}
</script>

</body>
</html>
